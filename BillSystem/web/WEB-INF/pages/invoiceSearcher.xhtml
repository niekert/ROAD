<ui:composition template="../template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions">


    <ui:define name="content">
        <f:event type="preRenderView" listener="#{userBean.redirectIfNotLoggedIn}"/>


        <div class="pill fullSearch">
            <h:form id="searchForm">
                <p:inputText id="txtSearch" styleClass="searchBar" placeholder="Search for invoices"
                             value="#{invoiceSearchBean.searchQuery}"/>
                <p:commandButton id="btnSearch" styleClass="searchIcon" value=""
                                 actionListener="#{invoiceSearchBean.search}" update="@(#resultContainer)"/>
            </h:form>
        </div>

        <h:panelGroup layout="block" id="resultContainer">
            <!--Render only if Search result is greater than 0-->
            <h:panelGroup layout="block" id="searchResults"
                          rendered="#{fn:length(invoiceSearchBean.foundInvoices) gt 0}">
                <!--TODO: Foreach-->
                <ui:repeat value="#{invoiceSearchBean.foundInvoices}" var="invoice">
                    <div class="pill">
                        <h4>#{invoice.username}'s Invoice ##{invoice.invoiceID} for #{invoice.month} / #{invoice.year}</h4>
                        <h:outputLabel value="Total amount: â‚¬#{invoice.total.toString()}"/>

                        <h:panelGroup layout="block" rendered="#{invoice.paymentStatus == 'NOT_PAID'}">
                            <div class="alert alert-danger">
                                This invoice has not yet been paid for.
                            </div>
                        </h:panelGroup>

                        <h:panelGroup layout="block" styleClass="alert alert-success" rendered="#{invoice.paymentStatus == 'SUCCESSFUL'}">
                            This invoice has been paid for.
                        </h:panelGroup>

                        <a href="invoicedetail/#{invoice.invoiceID}" class="btn btn-primary">View and edit</a>
                    </div>
                </ui:repeat>
            </h:panelGroup>

            <!--Render only when less than 0 result-->
            <h:panelGroup layout="block" id="noResults" styleClass="alert alert-info"
                          rendered="#{fn:length(invoiceSearchBean.foundInvoices) lt 1}">
                Your search query delivered no results. Please try again.
            </h:panelGroup>
        </h:panelGroup>

    </ui:define>


</ui:composition>

